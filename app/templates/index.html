{% extends "app.html" %}

{% block title %}
    {{ super() }} - Better business
{% endblock %}

{% block content %}
<main>
    <!-- Consentimiento de Cookies -->
    <div id="cookieConsent" class="fixed-bottom bg-light p-3" style="display: none;">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <p>Este sitio web utiliza cookies para mejorar la experiencia del usuario. Al utilizar nuestro sitio web, aceptas todas las cookies de acuerdo con nuestra política de cookies. <a href="/cookies">Más información</a>.</p>
                </div>
                <div class="col-md-4 text-md-end text-center">
                    <button id="acceptCookies" class="btn btn-custom">Aceptar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sección Hero -->
    <section class="hero-section position-relative min-vh-100">
        <video class="video-background w-100 h-100 object-fit-cover" autoplay muted loop>
            <source src="{{ url_for('static', filename='video/nfc-connect-video.mp4') }}" type="video/mp4">
            Tu navegador no soporta el video.
        </video>
        <div class="hero-overlay position-absolute top-0 start-0 w-100 h-100"></div>
        <div class="hero-content container position-relative">
            <h1>{{ _('Innovación y Tecnología para el Futuro') }}</h1>
            <p>{{ _('Descubre soluciones avanzadas que transforman tu negocio') }}</p>
            <a href="/store" class="btn btn-custom btn-lg">{{ _('Visita Nuestra Tienda') }}</a>
        </div>
    </section>

    <!-- Sección de Servicios para NFC Connect -->
    <section id="services" class="services-section py-5">
        <div class="container">
            <!-- Título de la Sección -->
            <div class="row mb-5 text-center">
                <div class="col-12">
                    <h2>{{ _('Nuestros Servicios') }}</h2>
                    <p class="lead">{{ _('En NFC Connect, ofrecemos una variedad de servicios para asegurar que tu negocio se mantenga a la vanguardia de la tecnología NFC.') }}</p>
                </div>
            </div>
            <div class="row">
                <!-- Servicio 1: Diseño Personalizado de Tarjetas NFC -->
                <div class="col-md-4 text-center mb-4" data-aos="fade-up">
                    <div class="service-card p-4 shadow rounded">
                        <i class="fas fa-paint-brush fa-3x text-primary mb-3"></i>
                        <h4 class="mt-3">{{ _('Diseño Personalizado') }}</h4>
                        <p>{{ _('Creamos tarjetas NFC completamente personalizadas que reflejan la identidad de tu marca. Elige entre una amplia gama de diseños, colores y materiales para destacar en cada interacción.') }}</p>
                        <a href="{{ url_for('service_detail', service_slug='diseno-personalizado') }}" class="btn btn-custom">Explorar</a>
                    </div>
                </div>
                <!-- Servicio 2: Integración con Linktree -->
                <div class="col-md-4 text-center mb-4" data-aos="fade-up" data-aos-delay="100">
                    <div class="service-card p-4 shadow rounded">
                        <i class="fas fa-link fa-3x text-primary mb-3"></i>
                        <h4 class="mt-3">{{ _('Integración con Linktree') }}</h4>
                        <p>{{ _('Nuestras tarjetas NFC redirigen a tus clientes a un Linktree personalizado, donde pueden acceder fácilmente a todos tus servicios, redes sociales y plataformas esenciales con un simple escaneo.') }}</p>
                        <a href="{{ url_for('service_detail', service_slug='integracion-linktree') }}" class="btn btn-custom">Descubrir</a>

                    </div>
                </div>
                <!-- Servicio 3: Gestión y Análisis de Enlaces -->
                <div class="col-md-4 text-center mb-4" data-aos="fade-up" data-aos-delay="200">
                    <div class="service-card p-4 shadow rounded">
                        <i class="fas fa-chart-line fa-3x text-primary mb-3"></i>
                        <h4 class="mt-3">{{ _('Gestión y Análisis') }}</h4>
                        <p>{{ _('Monitorea el rendimiento de tus enlaces con nuestras herramientas analíticas integradas. Obtén insights valiosos sobre la interacción de tus clientes y optimiza tu estrategia de marketing en consecuencia.') }}</p>
                        <a href="{{ url_for('service_detail', service_slug='gestion-analisis') }}" class="btn btn-custom">Saber Más</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Sección de Videos con Swiper.js -->
    <section class="video-carousel py-5 bg-light">
        <div class="container">
            <div class="row mb-4 text-center">
                <div class="col-12">
                    <h2>{{ _('Nuestros Clientes Agradecen') }}</h2>
                    <p class="lead">{{ _('Mira lo que nuestros clientes tienen para decir sobre sus experiencias con nosotros.') }}</p>
                </div>
            </div>
            <!-- Swiper -->
            <div class="swiper-container">
                <div class="swiper-wrapper">
                    <!-- Video 1 -->
                    <div class="swiper-slide">
                        <div class="video-card">
                            <video class="video-feed-item" controls muted loop playsinline>
                                <source src="{{ url_for('static', filename='video/cliente1.mp4') }}" type="video/mp4">
                                Tu navegador no soporta el video.
                            </video>
                            <div class="video-caption">
                                <h5>{{ _('Cliente 1') }}</h5>
                                <p>{{ _('Descripción breve del testimonio del cliente 1.') }}</p>
                            </div>
                        </div>
                    </div>
                    <!-- Video 2 -->
                    <div class="swiper-slide">
                        <div class="video-card">
                            <video class="video-feed-item" controls muted loop playsinline>
                                <source src="{{ url_for('static', filename='video/cliente1.mp4') }}" type="video/mp4">
                                Tu navegador no soporta el video.
                            </video>
                            <div class="video-caption">
                                <h5>{{ _('Cliente 2') }}</h5>
                                <p>{{ _('Descripción breve del testimonio del cliente 2.') }}</p>
                            </div>
                        </div>
                    </div>
                    <!-- Video 3 -->
                    <div class="swiper-slide">
                        <div class="video-card">
                            <video class="video-feed-item" controls muted loop playsinline>
                                <source src="{{ url_for('static', filename='video/cliente1.mp4') }}" type="video/mp4">
                                Tu navegador no soporta el video.
                            </video>
                            <div class="video-caption">
                                <h5>{{ _('Cliente 3') }}</h5>
                                <p>{{ _('Descripción breve del testimonio del cliente 3.') }}</p>
                            </div>
                        </div>
                    </div>
                    <!-- Video 4 -->
                    <div class="swiper-slide">
                        <div class="video-card">
                            <video class="video-feed-item" controls muted loop playsinline>
                                <source src="{{ url_for('static', filename='video/cliente1.mp4') }}" type="video/mp4">
                                Tu navegador no soporta el video.
                            </video>
                            <div class="video-caption">
                                <h5>{{ _('Cliente 3') }}</h5>
                                <p>{{ _('Descripción breve del testimonio del cliente 3.') }}</p>
                            </div>
                        </div>
                    </div>
                    <!-- Video 5 -->
                    <div class="swiper-slide">
                        <div class="video-card">
                            <video class="video-feed-item" controls muted loop playsinline>
                                <source src="{{ url_for('static', filename='video/cliente1.mp4') }}" type="video/mp4">
                                Tu navegador no soporta el video.
                            </video>
                            <div class="video-caption">
                                <h5>{{ _('Cliente 3') }}</h5>
                                <p>{{ _('Descripción breve del testimonio del cliente 3.') }}</p>
                            </div>
                        </div>
                    </div>
                    <!-- Video 6 -->
                    <div class="swiper-slide">
                        <div class="video-card">
                            <video class="video-feed-item" controls muted loop playsinline>
                                <source src="{{ url_for('static', filename='video/cliente1.mp4') }}" type="video/mp4">
                                Tu navegador no soporta el video.
                            </video>
                            <div class="video-caption">
                                <h5>{{ _('Cliente 3') }}</h5>
                                <p>{{ _('Descripción breve del testimonio del cliente 3.') }}</p>
                            </div>
                        </div>
                    </div>
                    <!-- Video 7 -->
                    <div class="swiper-slide">
                        <div class="video-card">
                            <video class="video-feed-item" controls muted loop playsinline>
                                <source src="{{ url_for('static', filename='video/cliente1.mp4') }}" type="video/mp4">
                                Tu navegador no soporta el video.
                            </video>
                            <div class="video-caption">
                                <h5>{{ _('Cliente 3') }}</h5>
                                <p>{{ _('Descripción breve del testimonio del cliente 3.') }}</p>
                            </div>
                        </div>
                    </div>
                    <!-- Video 8 -->
                    <div class="swiper-slide">
                        <div class="video-card">
                            <video class="video-feed-item" controls muted loop playsinline>
                                <source src="{{ url_for('static', filename='video/cliente1.mp4') }}" type="video/mp4">
                                Tu navegador no soporta el video.
                            </video>
                            <div class="video-caption">
                                <h5>{{ _('Cliente 3') }}</h5>
                                <p>{{ _('Descripción breve del testimonio del cliente 3.') }}</p>
                            </div>
                        </div>
                    </div>
                    <!-- Agrega más slides según sea necesario -->
                </div>
            </div>
        </div>
    </section>

    <!-- Sección de Productos -->
    <section class="store-section py-5">
        <div class="container">
            <div class="row mb-5 text-center">
                <div class="col-12">
                    <h2>{{ _('Nuestra Tienda') }}</h2>
                    <p class="lead">{{ _('Explora nuestros productos y servicios diseñados para impulsar tu negocio.') }}</p>
                </div>
            </div>
            <div class="row">
                {% for product in products %}
                <div class="col-md-4 mb-4" data-aos="fade-up">
                    <div class="card h-100">
                        <a href="{{ url_for('product_detail', product_id=product.id) }}">
                            <img src="{{ url_for('static', filename='img/' ~ product.image_file) }}" class="card-img-top" alt="{{ product.name }}">
                        </a>
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">
                                <a href="{{ url_for('product_detail', product_id=product.id) }}" class="text-decoration-none text-dark">
                                    {{ product.name }}
                                </a>
                            </h5>
                            <p class="card-text">{{ product.description }}</p>
                            <p class="card-text"><strong>{{ _('Precio') }}:</strong> ${{ "%.2f"|format(product.price) }}</p>
                            <form action="{{ url_for('add_to_cart', product_id=product.id) }}" method="POST" class="mt-auto">
                                {{ add_to_cart_form.hidden_tag() }}
                                <div class="d-flex justify-content-center">
                                    <button type="submit" class="btn btn-custom" onclick="handleAddToCart(event, '{{ product.id }}')">{{ _('Añadir al Carrito') }}</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            <!-- Botón para Ver Todos los Productos -->
            <div class="text-center mt-4">
                <a href="{{ url_for('store') }}" class="btn btn-primary">{{ _('Ver Todos los Productos') }}</a>
            </div>
        </div>
    </section>

    <!-- Modal de Confirmación Mejorado -->
    <div class="modal fade" id="cartModal" tabindex="-1" aria-labelledby="cartModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-success text-white border-0">
                    <h5 class="modal-title" id="cartModalLabel">
                        <i class="fas fa-check-circle me-2"></i>¡Producto añadido correctamente!
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="text-center mb-4">
                        <i class="fas fa-shopping-cart fa-3x text-success mb-3"></i>
                        <p class="lead">¿Qué te gustaría hacer ahora?</p>
                    </div>
                    <div class="d-grid gap-2">
                        <a href="{{ url_for('cart_view') }}" class="btn btn-custom btn-lg">
                            <i class="fas fa-shopping-cart me-2"></i>Ver carrito
                        </a>
                        <button type="button" class="btn btn-outline-secondary btn-lg" data-bs-dismiss="modal">
                            <i class="fas fa-store me-2"></i>Seguir comprando
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div></button>

    <!-- Sección de Preguntas Frecuentes (FAQ) Mejorada -->
    <section id="faq" class="faq-section py-5 bg-light">
        <div class="container">
            <div class="row mb-5 text-center">
                <div class="col-12">
                    <h2>{{ _('Preguntas Frecuentes') }}</h2>
                    <p class="lead">{{ _('Encuentra respuestas a las preguntas más comunes sobre nuestros servicios y productos.') }}</p>
                </div>
            </div>
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="accordion" id="faqAccordion">
                        <!-- Pregunta 1 -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingOne">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                                    {{ _('¿Cómo puedo realizar un pedido?') }}
                                </button>
                            </h2>
                            <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    {{ _('Selecciona tus productos favoritos, agrégalos al carrito y finaliza tu compra siguiendo las instrucciones.') }}
                                </div>
                            </div>
                        </div>
                        <!-- Pregunta 2 -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingTwo">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                    {{ _('¿Ofrecen soporte técnico?') }}
                                </button>
                            </h2>
                            <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    {{ _('Sí, ofrecemos soporte técnico para todos nuestros productos y servicios. Puedes contactarnos en cualquier momento.') }}
                                </div>
                            </div>
                        </div>
                        <!-- Pregunta 3 -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingThree">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                    {{ _('¿Cuáles son las formas de pago aceptadas?') }}
                                </button>
                            </h2>
                            <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    {{ _('Aceptamos tarjetas de crédito, PayPal, y transferencias bancarias.') }}
                                </div>
                            </div>
                        </div>
                        <!-- Pregunta 4 -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingFour">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                                    {{ _('¿Puedo obtener un reembolso?') }}
                                </button>
                            </h2>
                            <div id="collapseFour" class="accordion-collapse collapse" aria-labelledby="headingFour" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    {{ _('Sí, puedes solicitar un reembolso dentro de los primeros 30 días si no estás satisfecho con tu compra.') }}
                                </div>
                            </div>
                        </div>
                        <!-- Agrega más preguntas según sea necesario -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Sección de Suscripción a la Newsletter -->
    <section id="newsletter" class="newsletter-section py-5 bg-secondary text-white">
        <div class="container">
            <div class="row mb-4 text-center">
                <div class="col-12">
                    <h2>{{ _('Suscríbete a Nuestra Newsletter') }}</h2>
                    <p class="lead">{{ _('Recibe las últimas noticias y actualizaciones directamente en tu correo electrónico.') }}</p>
                </div>
            </div>
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <form action="{{ url_for('subscribe') }}" method="POST" class="d-flex">
                        {% if csrf_token %}
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        {% endif %}
                        <input type="email" name="email" class="form-control me-2" placeholder="{{ _('Tu correo electrónico') }}" required>
                        <button type="submit" class="btn btn-custom">{{ _('Suscribirse') }}</button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Chatbot Widget Mejorado -->
    <div id="chatbot" class="card shadow-lg chatbot-card" style="display: none;">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <span>Chatbot NFC Connect</span>
            <button type="button" class="btn-close btn-close-white" aria-label="Cerrar" onclick="toggleChat()"></button>
        </div>
        <div id="chat-content" class="card-body overflow-auto">
            <!-- Conversación -->
            <div class="message bot">
                <div class="message-text">¡Hola! Soy el Chatbot de NFC Connect. ¿En qué puedo ayudarte hoy?</div>
            </div>
        </div>
        <div class="card-footer">
            <div class="input-group">
                <input type="text" id="user-input" class="form-control" placeholder="Escribe tu mensaje..." aria-label="Mensaje">
                <button class="btn btn-custom" type="button" onclick="sendMessage()">
                    <i class="bi bi-send-fill"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Botón Flotante para abrir el Chatbot -->
    <button id="openChatBtn" class="btn btn-primary rounded-circle shadow-lg chatbot-open-btn" title="Abrir Chatbot" onclick="toggleChat()">
        <i class="bi bi-chat-dots-fill"></i>
    </button>
</main>
{% endblock %}

{% block scripts %}
{{ super() }}
<!-- Chatbot Script Mejorado -->
<script>
    // Función para mostrar/ocultar el Chatbot
    function toggleChat() {
        const chatbot = document.getElementById('chatbot');
        const openChatBtn = document.getElementById('openChatBtn');
        if (chatbot.style.display === 'none' || chatbot.style.display === '') {
            chatbot.style.display = 'flex';
            openChatBtn.style.display = 'none';
        } else {
            chatbot.style.display = 'none';
            openChatBtn.style.display = 'flex';
        }
    }

    // Función para enviar mensaje
    async function sendMessage() {
        const userInput = document.getElementById('user-input');
        const message = userInput.value.trim();
        if (message === '') return;

        appendMessage('user', message);
        userInput.value = '';
        userInput.focus();

        // Scroll hacia abajo
        scrollToBottom();

        // Enviar mensaje al servidor
        try {
            const response = await fetch('{{ url_for("api_chat") }}', {  
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ message: message }),
            });

            if (!response.ok) {  // Verifica si la respuesta no es OK
                const errorText = await response.text();
                throw new Error(`Error ${response.status}: ${response.statusText}\n${errorText}`);
            }

            const data = await response.json();
            if (data.reply) {
                appendMessage('bot', data.reply);
                scrollToBottom();
            } else if (data.error) {
                appendMessage('bot', data.error);
                scrollToBottom();
            }
        } catch (error) {
            console.error('Error:', error);
            appendMessage('bot', 'Lo siento, ha ocurrido un error.');
            scrollToBottom();
        }
    }

    // Función para agregar mensaje al chat
    function appendMessage(sender, message) {
        const chatContent = document.getElementById('chat-content');
        const messageElement = document.createElement('div');
        messageElement.classList.add('message', sender);

        const messageText = document.createElement('div');
        messageText.classList.add('message-text', sender === 'user' ? 'user-message' : 'bot-message');
        messageText.textContent = message;

        messageElement.appendChild(messageText);
        chatContent.appendChild(messageElement);

        // Animación de aparición
        messageText.style.opacity = 0;
        setTimeout(() => {
            messageText.style.transition = 'opacity 0.5s';
            messageText.style.opacity = 1;
        }, 100);
    }

    // Función para hacer scroll al final del chat
    function scrollToBottom() {
        const chatContent = document.getElementById('chat-content');
        chatContent.scrollTop = chatContent.scrollHeight;
    }

    // Manejar el envío con la tecla Enter
    document.getElementById('user-input').addEventListener('keypress', function(event) {
        if (event.key === 'Enter') {
            event.preventDefault();
            sendMessage();
        }
    });

    // Función para manejar el añadir al carrito
    function handleAddToCart(event, productId) {
        event.preventDefault();
        const form = event.target.closest('form');
        
        fetch(form.action, {
            method: 'POST',
            body: new FormData(form),
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => {
            if (!response.ok) {
                return response.json().then(errData => {
                    throw new Error(errData.error || 'Error desconocido');
                });
            }
            return response.json();
        })
        .then(data => {
            if(data.success) {
                // Mostrar el modal de confirmación
                var modal = new bootstrap.Modal(document.getElementById('cartModal'));
                modal.show();
            } else {
                // Manejar errores específicos
                alert(data.error || 'Error al añadir al carrito.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Ha ocurrido un error al procesar tu solicitud.');
        });
    }

    var swiper = new Swiper('.swiper-container', {
        direction: 'horizontal',
        loop: true,
        slidesPerView: 3, // Muestra 3 slides en pantallas grandes
        spaceBetween: 20,
        pagination: {
            el: '.swiper-pagination',
            clickable: true,
        },
        navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
        },
        grabCursor: true,
        breakpoints: {
            992: {
                slidesPerView: 3,
            },
            768: {
                slidesPerView: 2,
            },
            0: {
                slidesPerView: 1,
            },
        },
    });
</script>
{% endblock %}